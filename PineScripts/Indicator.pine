//@version=5
indicator(title = "Trend indicator", shorttitle="CM_EMA TrendBars",overlay=true, timeframe = "", timeframe_gaps = true)
ema1 = input(17, title="EMA UpTrend")
shema = input(true, title="Show EMA Trend is Based On?")

usedEma = ta.ema(close, ema1)

atrPeriod = input.int(27,"ATR Length", minval = 1)
factor =    input.float(2.40,"Factor",     minval = 0.01, step = 0.01)

emaUpColor = ta.crossover(hlc3, usedEma)
emaDownColor = ta.crossunder(hlc3, usedEma)

[supertrend, direction] = ta.supertrend(factor, atrPeriod)

buy = (hlc3 >= usedEma) and (direction[1] > direction) 
buyDown = (hlc3 < usedEma) and (direction[1] < direction)

plotshape(buy, location=location.belowbar, color=color.green, style=shape.triangleup, size=size.small, title="Uptrend Signal")
plotshape(buyDown, location=location.abovebar, color=color.red, style=shape.triangledown, size=size.small, title="Downtrend Signal")

alertcondition(buy, title='buy', message='{"action": "buy", "close": "{{close}}", "time": "{{time}}"}')
alertcondition(buyDown, title='sell', message='{"action": "sell", "close": "{{close}}", "time": "{{time}}"}')
